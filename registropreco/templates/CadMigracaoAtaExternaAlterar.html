<!-- 220038-- -->
<form
	action="{NOMEPROGRAMA}.php?ano={ANO}&processo={PROCESSO}&orgao={ORGAO}&ata={ATA}"
	method="post" id="{NOMEPROGRAMA}" name="{NOMEPROGRAMA}" enctype="multipart/form-data">
	<table cellspacing="0" cellpadding="3" bordercolor="#75ADE6" border="1"
		bgcolor="#FFFFFF" width="100%" class="textonormal" summary="">
		<tbody>
			<tr>
				<td align="center" bgcolor="#75ADE6" valign="middle" class="titulo3"
					colspan="13">MANTER MIGRAÇÃO - ATA EXTERNA</td>
			</tr>
			<tr>
				<td colspan="13">
					<table border="0" width="100%" summary="">
						<tbody>
							<!-- BEGIN BLOCO_LICITACAO -->

							<tr>
								<td class="textonormal" bgcolor="#DCEDF7" width="20%"
									align="left">Nº da Ata Externa *</td>
								<td class="textonormal" width="80%" align="left"><input
									type="text" id="numeroAtaExterna" name="numeroAtaExterna"
									value="{VALOR_ATA}" /></td>
							</tr>
							<tr>
								<td class="textonormal" bgcolor="#DCEDF7" width="20%"
									align="left">Ano Processo *</td>
								<td class="textonormal" width="80%" align="left"><input
									type="text" id="anoAtaExterna" name="anoAtaExterna"
									value="{VALOR_ANO}" /></td>
							</tr>
							<tr>
								<td class="textonormal" bgcolor="#DCEDF7" width="20%"
									align="left">Processo Licitatório Externo *</td>
								<td class="textonormal" width="80%" align="left"><input
									type="text" id="processoLicitatorio" name="processoLicitatorio"
									value="{PROCESSO_LICITATORIO}" /></td>
							</tr>

							<tr>
								<td class="textonormal" bgcolor="#DCEDF7" width="20%"
									align="left">Modalidade</td>
								<td class="textonormal" width="80%" align="left"><select
									name="Modalidade" id="Modalidade" class="textonormal">
										<option value="">Selecione uma Modalidade</option>
										<!-- BEGIN BLOCO_MODALIDADE -->
										<option value="{VALOR_MODALIDADE}"{VALOR_MODALIDADE_SELECIONADO}>{DESCICAO_MODALIDADE}</option>
										<!-- END BLOCO_MODALIDADE -->
								</select></td>
							</tr>
							<tr>
								<td class="textonormal" bgcolor="#DCEDF7" width="20%"
									align="left">Òrgão Gestor da Ata Externa</td>
								<td class="textonormal" width="80%" align="left"><input
									type="text" id="orgaoLicitante" name="orgaoLicitante"
									value="{VALOR_ORGAO}" /></td>
							</tr>
							<tr>
								<td class="textonormal" bgcolor="#DCEDF7" width="20%"
									align="left">Objeto</td>
								<td class="textonormal" width="80%" align="left"><input
									type="text" id="objetoProcesso" name="objetoProcesso"
									value="{VALOR_OBJETO}" /> {VALOR_SEQ_ORGAO}</td>
							</tr>
							<tr>
								<td class="textonormal" bgcolor="#DCEDF7" width="40%"
									align="left">Documento(s) *</td>
								<td class="textonormal">

									<!-- BEGIN BLOCO_FILE -->

									<input type="file" name="fileArquivo" value="{VALOR_DOCUMENTO}" />
									<input type="submit" name="inserir" value="Incluir" class="botao" onclick="javascript:enviar('Inserir')" />

									<!-- END BLOCO_FILE -->

									<ul>{VALOR_DOCUMENTOS_ATA}</ul>

								</td>
							</tr>
							<tr>
								<td class="textonormal" bgcolor="#DCEDF7" width="20%"
									align="left">Data Inicial da Ata</td>
								<td class="textonormal" width="80%" align="left">
									<input type="text" name="dataInicialProcesso" id="dataInicialProcesso" size="10" maxlength="10" value="{VALOR_DATA}" class="textonormal">
                                    <a href="javascript:janela('../calendario.php?Formulario={NOMEPROGRAMA}&Campo=dataInicialProcesso','Calendario',220,170,1,0)">
                                        <img src="../midia/calendario.gif" border="0" alt=""></a> <font class="textonormal">dd/mm/aaaa</font>
								</td>
							</tr>
							<tr>
								<td class="textonormal" bgcolor="#DCEDF7" width="20%"
									align="left">Vigência da Ata</td>
								<td class="textonormal" width="80%" align="left"><input
									type="text" id="vigenciaProcesso" name="vigenciaProcesso"
									value="{VALOR_VIGENCIA}" size="4"/> Meses</td>
							</tr>
							<tr>
                                <td class="textonormal" bgcolor="#DCEDF7" width="30%">Fornecedor Original</td>
                                <td class="textonormal">
                                    <input type="radio" name="fornecedorOrigDoc" id="fornceOrgiCnPJ" value="CNPJ" onchange="javascript:radioClicked('CNPJ','fornecedorOriginalProcesso');">
                                    <label for="orange">CNPJ</label>
                                    <input type="radio" name="fornecedorOrigDoc" id="fornceOrgiCPF" value="CPF"  onchange="javascript:radioClicked('CPF','fornecedorOriginalProcesso');">
                                    <label for="orange">CPF</label>
                                    &nbsp;
                                    <input value="{FORNECEDOR_ORIGINAL_ATA_EXTERNA}" type="text" name="fornecedorOriginalProcesso" id="fornecedorOriginalProcesso">
                                    <a href="javascript:enviar('original');"><img src="../midia/lupa.gif" border="0"></a>
                                    <br/>{VALOR_DESCRITIVO_FORNECEDOR_ORIGINAL}<BR/>
                                    {VALOR_DESCRITIVO_FORNECEDOR_LOGRADOURO}
                                </td>
                            </tr>
                            <tr>
                                <td class="textonormal" bgcolor="#DCEDF7" width="30%">Forncedor Atual</td>
                                <td class="textonormal">
                                    <input type="radio" name="fornecedorAtualdoc" id="fornceAtualCnPJ" value="CNPJ" onchange="javascript:radioClicked('CNPJ','fornecedorAtualProcesso');">
                                    <label for="orange">CNPJ</label>
                                    <input type="radio" name="fornecedorAtualdoc" id="fornceAtualCPF" value="CPF" onchange="javascript:radioClicked('CPF','fornecedorAtualProcesso');">
                                    <input type="hidden" value="{CODIGO_FORNECEDOR_ORIGINAL}" name="codigoFornecedor">
                                    <label for="orange">CPF</label>
                                    &nbsp;
                                    <input value="{FORNECEDOR_ATUAL_ATA_EXTERNA}" type="text" name="fornecedorAtualProcesso" id="fornecedorAtualProcesso">
                                    <a href="javascript:enviar('atual');"><img src="../midia/lupa.gif" border="0"></a>
                                    <input type="hidden" value="{CODIGO_FORNECEDOR_ATUAL}" name="codigoFornecedorAtual">
                                    <br/>{VALOR_DESCRITIVO_FORNECEDOR_ATUAL}<br/>
                                    {VALOR_DESCRITIVO_FORNECEDOR_ATUAL_LOGRADOURO}
                                </td>
                            </tr>

							<!-- END BLOCO_LICITACAO -->
						</tbody>
					</table>
				</td>
			</tr>
			<tr>
				<td align="center" bgcolor="#75ADE6" valign="middle" class="titulo3"
					colspan="13">ITENS DA ATA</td>
			</tr>

			<!-- BEGIN BLOCO_ITEM_TOTAL -->


			<tr>
				<td class="textoabason" bgcolor="#DCEDF7" width="127px"
					align="center">ORD</td>
				<td class="textoabason" bgcolor="#DCEDF7" width="127px"
					align="center">TIPO</td>
				<td class="textoabason" bgcolor="#DCEDF7" width="127px"
					align="center">COD. RED.</td>
				<td class="textoabason" bgcolor="#DCEDF7" width="127px"
					align="center">DESCRIÇÃO MATERIAL/SERVIÇO</td>
				<td class="textoabason" bgcolor="#DCEDF7" width="127px"
					align="center">UND.</td>
				<td class="textoabason" bgcolor="#DCEDF7" width="127px"
					align="center">QTD ORIGINAL</td>
				<td class="textoabason" bgcolor="#DCEDF7" width="127px"
					align="center">VALOR ORIGINAL UNIT</td>
				<td class="textoabason" bgcolor="#DCEDF7" width="127px"
					align="center">VALOR TOTAL</td>
				<td class="textoabason" bgcolor="#DCEDF7" width="127px"
					align="center">LOTE</td>
				<td class="textoabason" bgcolor="#DCEDF7" width="127px"
					align="center">QTD ATUAL</td>
				<td class="textoabason" bgcolor="#DCEDF7" width="127px"
					align="center">VALOR UNITÁRIO ATUAL</td>
				<td class="textoabason" bgcolor="#DCEDF7" width="127px"
					align="center">VALOR TOTAL ATUAL</td>
				<td class="textoabason" bgcolor="#DCEDF7" width="127px"
					align="center">SITUAÇÃO</td>
			</tr>

			<!-- BEGIN BLOCO_RESULTADO_ATAS -->

			<!-- BEGIN BLOCO_ITEM -->
			<tr>
				<input type="hidden" name="itemAta[{ITEM_ORD}][itemId]" value="{VALOR_ITEM_ID}">
				<td class="textonormal" width="50px" align="center">
					<input type="radio" name="itemAta[{ITEM_ORD}][codigoReduzido]" value="{VALOR_CODIGO_REDUZIDO}"
					class="ajustarSelecao" />
					{VALOR_ORDEM}
				</td>
				<td class="textonormal" width="52px" align="center">
					{VALOR_TIPO}
				</td>
				<td class="textonormal" width="52px" align="center">
					{VALOR_CODIGO_REDUZIDO}
				</td>
				<td class="textonormal" width="70px" align="center">
					{VALOR_DESCRICAO_ITEM}
				</td>
				<td class="textonormal" width="50px" align="center">
					{VALOR_UND}
				</td>
				<td class="textonormal" width="50px" align="center">
					<input value="{VALOR_QTD_ORIGINAL}" name="itemAta[{ITEM_ORD}][quantidadeOriginalItem]"
					class="quantidadeItem dinheiro4casas" size="5" />
				</td>
				<td class="textonormal" width="50px" align="center">
					<input value="{VALOR_ORIGINAL_UNIT}" name="itemAta[{ITEM_ORD}][valorUnitarioOriginalItem]"
					class="valorItem dinheiro4casas" size="5" />
				</td>
				<td class="textonormal" width="50px" align="center">
					{VALOR_TOTAL_ORIGINAL}
				</td>
				<td class="textonormal" width="50px" align="center">
					{VALOR_LOTE}
				</td>
				<td class="textonormal" width="50px" align="center">
					<input value="{VALOR_QTD_ATUAL}" name="itemAta[{ITEM_ORD}][quantidadeAtualItem]"
					class="quantidadeItemAtual dinheiro4casas" size="5" />
				</td>
				<td class="textonormal" width="50px" align="center">
					<input value="{VALOR_ATUAL_UNIT}" name="itemAta[{ITEM_ORD}][valorUnitarioAtualItem]"
					class="valorUnitario dinheiro4casas" size="5" />
				</td>
				<td class="textonormal" width="50px" align="center">
					{VALOR_TOTAL_ATUAL}
				</td>
				<td class="textonormal" width="50px" align="center">
					<select name="itemAta[{ITEM_ORD}][situacaoAta]" class="textonormal" id="SITUACAO[{ORD_ITEM}]">
                        <!-- BEGIN BLOCO_SITUACAO -->
                        <option  value="{VALOR_SITUACAO}" {SITUACAO_SELECTED}>{SITUACAO_TEXT}</option>
                        <!-- END BLOCO_SITUACAO -->
                    </select>
               </td>
			</tr>

			<!-- END BLOCO_ITEM -->
			<tr>
                <td class="titulo3 itens_material menosum" colspan="11">TOTAL DA ATA</td>
                <td align="right" class="textonormal">
                    <span id="valorTotal">{TOTAL_ATA}</span>
                </td>
                <td align="right" class="textonormal"></td>
            </tr>
			<!-- END BLOCO_RESULTADO_ATAS -->

			<!-- END BLOCO_ITEM_TOTAL -->
			<tr>
				<td class="textonormal" align="right" colspan="13">
					<input type="hidden" id="documentoExcluir" name="documentoExcluir" value="" />
					<!-- BEGIN BLOCO_BOTAO -->
					<input type="hidden"
						name="InicioPrograma"
						value="1" />
					<input type="hidden"
						name="ano"
						value="{VALOR_ANO_SESSAO}"
						class="botao"
						onclick="javascript:enviar('Alterar')" />
					<input type="hidden"
						name="processo"
						value="{VALOR_PROCESSO_SESSAO}"
						class="botao"
						onclick="javascript:enviar('Visualizar')" />
					<input type="hidden"
						name="ata"
						value="{VALOR_ATA_SESSAO}"
						class="botao"
						onclick="javascript:enviar('Inativar')" />
					<input type="hidden"
						name="orgao"
						value="{VALOR_ORGAO_SESSAO}"
						class="botao"
						onclick="javascript:enviar('Inativar')" />
					<input type="button"
						name="adicionarItem"
						value="Adicionar Item"
						class="botao"
						onclick="javascript:AbreJanelaItem('../registropreco/CadIncluirItemRegistroPreco.php?ProgramaOrigem={NOMEPROGRAMA}&PesqApenas=C&Processo={PROCESSO}', 950, 350);" />
					<input type="button"
						name="retirarItem"
						value="Retirar Item"
						class="botao"
						onclick="javascript:enviar('RetirarItem')" />
					<input type="button"
						name="adicionarParticipante"
						value="Carona"
						class="botao"
						onclick="javascript:enviar('Carona');" />
					<input type="hidden"
						name="linkParticipante"
						value="{JANELA_ADICIONAR_PARTICIPANTE}">
					<input type="button"
						name="salvar"
						value="Salvar"
						class="botao"
						onclick="javascript:enviar('Salvar')" />
					<input type="button"
						name="voltar"
						value="Voltar"
						class="botao"
						onclick="javascript:enviar('Voltar')" />
					<input type="hidden"
						name="Botao"
						value=""
						id="Botao" />
					<!-- END BLOCO_BOTAO -->
				</td>
			</tr>
		</tbody>
	</table>
</form>
<script type="text/javascript">
	function enviar(valor) {
	    document.{NOMEPROGRAMA}.Botao.value = valor;
	    document.{NOMEPROGRAMA}.submit();
	}

	function validarValor() {
		var valorInput = document.{NOMEPROGRAMA}.vigencia.value;

	 	if (valorInput < 1) {
			document.{NOMEPROGRAMA}.vigencia.value = 0;
	 	}
	}

	function inserirFile(valor) {
		document.{NOMEPROGRAMA}.file.value = document.{NOMEPROGRAMA}.fileArquivo.value;
		document.{NOMEPROGRAMA}.submit();
	}

	function AbreJanelaItem(url,largura,altura){
		window.open(url,'paginaitem','status=no,scrollbars=yes,left=90,top=150,width='+largura+',height='+altura);
	}

	function AbreJanela(url, largura, altura) {
		window.open(
			url,
			'paginadetalhe',
			'status=no,scrollbars=yes,left=90,top=150,width='+largura+',height='+altura
		);
	}
    function acrescentarParticipante(){
    	var valor = undefined;

		$('input:radio[name=idItem]').each(function() {
        	if ($(this).is(':checked')) {
				valor = parseInt($(this).val());
            }
		});

        var link = $("input[name=linkParticipante]").val();

		if (valor != undefined) {
	        link = link + "&item=" + valor;
		}

        AbreJanela(link, 700, 370);

    }
    function radioClicked(tipo,name) {
        if(tipo =="CNPJ"){
            $("#"+name).mask("99.999.999/9999-99");
        } else{
            $("#"+name).mask("999.999.999-99");
        }
    }

    function float2moeda(num) {
        num = parseFloat(num); // garantindo que o número vindo é float
        // tratando fração para 4 dígitos
        noDigitos =4;
        numeroMoeda = number_format (num, noDigitos, ',','.');
        return numeroMoeda;
    }

    function moeda2float(moeda){
        moeda = moeda.replace(/\./g,"");
        moeda = moeda.replace(/\,/g,".");
        return parseFloat(moeda);
    }

    function calcularValorTotalOrigem(quantidade, valor) {
        if(quantidade != null && valor != null){
            return quantidade * moeda2float(valor);
        }
        return 0;
    }


	$(document).ready(function() {

		var valorFornecedorOriginal = $('#fornecedorOriginalProcesso').val();
        var valorFornecedorAtual = $('#fornecedorAtualProcesso').val();

        if (String(valorFornecedorOriginal).length == 11) {
            radioClicked("CPF","fornecedorOriginalProcesso");
            $("#fornceOrgiCPF").prop("checked", true);
        } else {
            $("#fornceOrgiCnPJ").prop("checked", true);
            radioClicked("CNPJ","fornecedorOriginalProcesso");
        }

        if (String(valorFornecedorAtual).length == 14) {
            $("#fornceAtualCnPJ").prop("checked", true);
            radioClicked("CNPJ","fornecedorAtualProcesso");
        } else {
            if (String(valorFornecedorAtual).length > 0) {
                $("#fornceAtualCPF").prop("checked", true);
                radioClicked("CPF","fornecedorAtualProcesso");
            }
        }

		$(".ajustarSelecao").change(function() {
			$(".ajustarSelecao").prop("checked", false);
			$(this).prop("checked", true);
		});

		$('.removerDocumento').click(function(e){
            e.preventDefault();
            $('#documentoExcluir').val($(this).attr('doc'));
            $('#Botao').val('RetirarDocumento');
            $("#{NOMEPROGRAMA}").submit();
        });

		/*Realiza o calculo do valor total para o valor original*/
        $(".quantidadeOriginalItem").on("blur", function () {
            var valorItem = $(this).parent('td').next('td').find('.valorItem');
            var total = calcularValorTotalOrigem($(this).val(), $(valorItem).val());
            total = float2moeda(total);

            $(valorItem).parent('td').next('td').find('.totalValorItem').val(total);
        });

        $(".valorItem").on("blur", function () {
            var qtdItem = $(this).parent('td').prev('td').find('.quantidadeItem');
            var total = calcularValorTotalOrigem($(qtdItem).val(),$(this).val());
            total = float2moeda(total);

            $(this).parent('td').next('td').find('.totalValorItem').val(total);
        });

        /*Realiza o calculo do valor total para o valor atual*/
        $(".quantidadeItemAtual").on("blur", function () {
            var valorItem = $(this).parent('td').next('td').find('.valorUnitario');
            var total = calcularValorTotalOrigem($(this).val(), $(valorItem).val());
            total = float2moeda(total);

            $(valorItem).parent('td').next('td').find('.totalUnitario').val(total);
        });

        $(".valorUnitario").on("blur", function () {
            var qtdItem = $(this).parent('td').prev('td').find('.quantidadeItemAtual');
            var total = calcularValorTotalOrigem($(qtdItem).val(),$(this).val());
            total = float2moeda(total);

            $(this).parent('td').next('td').find('.totalUnitario').val(total);
        });
	});
</script>
